{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Question Feed</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <!-- Add Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <!-- Add Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <!-- ✅ Top NavBar -->
  <div class="top-navbar">
    <img src="{% static 'images/base color-wide.svg' %}" class="top-logo" alt="Logo">
  </div>

  <!-- ✅ Main Content -->
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <ul class="sidebar-links">
        <li><a href="{% url 'AdminDashboard:admin_dashboard' %}">Dashboard (Home)</a></li>
        <li><a href="#">Interview Scheduling</a></li>
        <li><a href="#">Evaluation Insights</a></li>
        <li class="sidebar-section">Other Information</li>
        <li><a href="{% url 'Questions:questions' %}">Questions Feed</a></li>
        <li><a href="{% url 'AdminDashboard:candidate' %}">Candidates Info</a></li>
        <li><a href="#">Help</a></li>
        <li class="sidebar-section">Settings</li>
        <li><a href="#">Personal Settings</a></li>
      </ul>
    </div>

    <div class="main-content">
      <!-- Header -->
      <div class="question-header">
        <div>
          <div class="question-title">Question Feed</div>
          <div class="question-subtitle">Let's take a look at your Fields</div>
        </div>
        <div class="header-buttons">
          <button class="create-btn" onclick="openFieldPopup()">+ Add Skill Feed</button>
        </div>
      </div>

      <!-- Messages -->
      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Cards -->
      <div class="cards-container">
        {% for item in field_data %}
          <div class="card-wrapper">
            <a href="{% url 'Questions:edit_question' item.field_slug %}" class="card-link">
              <div class="question-card">
                <div class="card-header">
                  <h3>{{ item.field_name }}</h3>
                  <div class="question-total">{{ item.total }} questions</div>
                </div>
                <div class="card-body">
                  <div class="level-stats">
                    <div class="level-item">
                      <div class="level-label">Advanced</div>
                      <div class="level-value">{{ item.advanced }}</div>
                    </div>
                    <div class="level-item">
                      <div class="level-label">Mid Level</div>
                      <div class="level-value">{{ item.mid }}</div>
                    </div>
                    <div class="level-item">
                      <div class="level-label">Beginner</div>
                      <div class="level-value">{{ item.beginner }}</div>
                    </div>
                  </div>
                </div>
              </div>
            </a>
            <button class="delete-field-btn" onclick="confirmDeleteField('{{ item.field_id }}', '{{ item.field_name }}')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Field Popup Form -->
  <div class="popup-overlay" id="fieldPopup">
    <div class="popup-content">
      <div class="popup-header">
        <h3>Add New Field</h3>
        <button type="button" class="close-btn" onclick="closeFieldPopup()">&times;</button>
      </div>
      <form method="POST" id="fieldForm">
        {% csrf_token %}
        <input type="hidden" name="create_field" value="1">
        <div class="form-group mb-3">
          <label for="id_name">Field Name</label>
          <input type="text" name="name" id="id_name" class="form-control" required>
          {% if field_form.name.errors %}
          <div class="text-danger">
            {{ field_form.name.errors }}
          </div>
          {% endif %}
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Create Field</button>
          <button type="button" class="btn btn-secondary" onclick="closeFieldPopup()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Delete Field</h3>
        <button type="button" class="close-btn" onclick="closeDeleteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the field "<span id="fieldName"></span>"?</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>
      <div class="modal-footer">
        <form method="POST" id="deleteForm">
          {% csrf_token %}
          <input type="hidden" name="delete_field" value="1">
          <input type="hidden" name="field_id" id="fieldId">
          <button type="button" class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Add jQuery and Select2 -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    $(document).ready(function() {
      // Remove Select2 initialization for question form

      // Field form validation
      $('#fieldForm').on('submit', function(e) {
        e.preventDefault();
        const fieldName = $('#id_name').val();
        
        if (!fieldName) {
          $('#id_name').addClass('is-invalid');
          if (!$('.alert-danger').length) {
            $('<div class="alert alert-danger">Please enter a field name.</div>')
              .insertBefore(this);
          }
        } else {
          this.submit();
        }
      });

      // Clear validation on field change
      $('select, textarea, input').on('change', function() {
        $(this).removeClass('is-invalid');
      });
    });

    function openFieldPopup() {
      document.getElementById('fieldPopup').style.display = 'flex';
      $('#fieldForm')[0].reset();
      $('.alert-danger').remove();
    }

    function closeFieldPopup() {
      document.getElementById('fieldPopup').style.display = 'none';
    }

    // Close popup when clicking outside
    window.onclick = function(event) {
      const fieldPopup = document.getElementById('fieldPopup');
      if (event.target == fieldPopup) {
        closeFieldPopup();
      }
    }

    function confirmDeleteField(fieldId, fieldName) {
      event.preventDefault();
      event.stopPropagation();
      document.getElementById('fieldId').value = fieldId;
      document.getElementById('fieldName').textContent = fieldName;
      document.getElementById('deleteModal').style.display = 'flex';
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const deleteModal = document.getElementById('deleteModal');
      if (event.target == deleteModal) {
        closeDeleteModal();
      }
    }
  </script>

  <style>
    /* Remove question popup and related styles */
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .popup-content {
      background: white;
      padding: 2rem;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      color: #666;
    }

    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .alert {
      margin-bottom: 1rem;
    }

    .is-invalid {
      border-color: #dc3545;
    }

    .header-buttons {
      display: flex;
      gap: 1rem;
    }




    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      padding: 1rem;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
    }

    .card-link {
      text-decoration: none;
      color: inherit;
      transition: transform 0.2s ease;
      height: 100%;
    }

    .card-link:hover {
      transform: translateY(-3px);
    }

    .card-header {
      background: linear-gradient(#3cd88e, #268b5b, #268b5b);
      color: white;
      padding: 1.25rem;
      position: relative;
    }

    .card-header h3 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      padding-right: 80px;
    }

    .question-total {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      background: rgba(226, 227, 226, 0.22);
      padding: 0.35rem 0.75rem;
      border-radius: 15px;
      font-size: 0.85rem;
    }

    .card-body {
      padding: 1.25rem;
      flex-grow: 1;
    }

    .level-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.75rem;
    }

    .level-item {
      text-align: center;
      padding: 0.75rem 0.5rem;
      background: #f8f9fa;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      min-height: 70px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .level-item:hover {
      background: #e9ecef;
    }

    .level-label {
      font-size: 0.75rem;
      color: rgb(199, 204, 207);
      margin-bottom: 0.35rem;
      white-space: nowrap;
      width: 100%;
      text-align: center;
    }

    .level-value {
      font-size: 1.25rem;
      font-weight: 600;
      color: #268b5b;
      line-height: 1;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .cards-container {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 0.875rem;
        padding: 0.875rem;
      }
      .level-item {
        min-height: 65px;
        padding: 0.625rem 0.375rem;
      }
    }

    @media (max-width: 768px) {
      .cards-container {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 0.75rem;
        padding: 0.75rem;
      }

      .card-header {
        padding: 1rem;
      }

      .card-header h3 {
        font-size: 1.1rem;
        padding-right: 70px;
      }

      .question-total {
        font-size: 0.75rem;
        padding: 0.3rem 0.6rem;
      }

      .card-body {
        padding: 1rem;
      }

      .level-item {
        min-height: 60px;
        padding: 0.5rem 0.375rem;
      }

      .level-label {
        font-size: 0.7rem;
      }

      .level-value {
        font-size: 1.1rem;
      }

      .delete-field-btn {
        opacity: 1;
        width: 28px;
        height: 28px;
      }
    }

    @media (max-width: 480px) {
      .cards-container {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 0.625rem;
        padding: 0.625rem;
      }

      .level-item {
        min-height: 55px;
        padding: 0.375rem 0.25rem;
      }

      .level-label {
        font-size: 0.65rem;
        margin-bottom: 0.25rem;
      }

      .level-value {
        font-size: 1rem;
      }
    }

    @media (max-width: 360px) {
      .cards-container {
        grid-template-columns: 1fr;
      }
    }

    .card-wrapper {
      position: relative;
      height: 100%;
    }

    .delete-field-btn {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #dc3545;
      transition: all 0.2s ease;
      z-index: 2;
      opacity: 0;
    }

    .card-wrapper:hover .delete-field-btn {
      opacity: 1;
    }

    .delete-field-btn:hover {
      background: #dc3545;
      color: white;
      transform: scale(1.1);
    }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h3 {
      margin: 0;
      color: #dc3545;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .warning-text {
      color: #dc3545;
      font-size: 0.9rem;
      margin-top: 0.5rem;
    }

    .modal-footer {
      padding: 1rem;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    .btn-danger {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .btn-danger:hover {
      background-color: #c82333;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
    }
  </style>

  <!-- Add Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</body>
</html>
